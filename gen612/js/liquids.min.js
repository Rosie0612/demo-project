function AssetsManager(_anim){var self=this;this._itemCount=0;this._listCount=0;this._imgNum=0;this._imgLoadedNum=0;this._pipeline=4;this._imgMap={};this._texMap={};this._modelMap={};this._shaderMap={};this._assetsList={shaders:{},textures:{}};this.init=function(){if(this._firstItem=[],_anim._webGL){var shaders=[_anim._assetsPath+"/shaders/display_vtx.js",_anim._assetsPath+"/shaders/display_frg.js"];var textures=[_anim._assetsPath+"/img/liquids/red_1.png",_anim._assetsPath+"/img/liquids/red_2.png",_anim._assetsPath+"/img/liquids/yellow_1.png",_anim._assetsPath+"/img/liquids/yellow_2.png",_anim._assetsPath+"/img/liquids/black.png",_anim._assetsPath+"/img/liquids/red_1_n.png",_anim._assetsPath+"/img/liquids/red_2_n.png",_anim._assetsPath+"/img/liquids/yellow_1_n.png",_anim._assetsPath+"/img/liquids/yellow_2_n.png",_anim._assetsPath+"/img/liquids/black_n.png"];this._firstItem=[{_type:"texture",_list:textures},{_type:"shader",_list:shaders}];textures.forEach(function(texturePath){var id=texturePath.split("/").pop().replace(/\.png/g,"");self._assetsList.textures[id]=texturePath});shaders.forEach(function(shaderPath){var id=shaderPath.split("/").pop().replace(/\.js/g,"");self._assetsList.shaders[id]=shaderPath});console.log(self._assetsList)}};this.firstLoad=function(){for(var a=0;a<this._pipeline;a++){this.pipelineLoad()}};this.pipelineLoad=function(){var loader;if(!(this._itemCount>=this._firstItem.length)){var item=this._firstItem[this._itemCount];var path=item._list[this._listCount];var count=this._listCount;switch(item._type){case"texture":loader=new THREE.TextureLoader;loader.load(path,function(texture){self.loadTextureEnd(texture,item,count)});break;case"image":var img=new Image;img.onload=function(){self.loadImageEnd(this,item,count)};img.src=path;break;case"shader":loader=new XMLHttpRequest;loader.open("GET",path,true);loader.onreadystatechange=function(){if(loader.readyState===4){if(loader.status===200){self.loadShaderEnd(loader.responseText,item,count)}else{console.log("Shader loading failed")}}};loader.send(null);break}this._imgNum++;this._listCount++;if(this._listCount>=item._list.length){this._listCount=0;this._itemCount++}}};this.loadTextureEnd=function(texture,item,count){texture.needsUpdate=true;texture.minFilter=THREE.LinearFilter;texture.magFilter=THREE.LinearFilter;var id=item._list[count];this._texMap[id]=texture;this.checkFinishLoading()};this.loadImageEnd=function(img,item,count){var id=item._list[count];this._imgMap[id]=img;this.checkFinishLoading()};this.loadShaderEnd=function(shader,item,count){var id=item._list[count];this._shaderMap[id]=shader;this.checkFinishLoading()};this.checkFinishLoading=function(){this.pipelineLoad();if(++this._imgLoadedNum>=this._imgNum){_anim.partsLoadComp()}};this.getTex=function(id){var searchPath=this._assetsList.textures[id];var tex=null;for(var path in this._texMap){if(path.match(searchPath)){tex=this._texMap[path]}}return tex};this.getImage=function(searchPath){var img=null;for(var path in this._imgMap){if(path.match(searchPath)){img=this._imgMap[path]}}return img};this.getShader=function(searchPath){var shader=null;for(var path in this._shaderMap){if(path.match(searchPath)){shader=this._shaderMap[path]}}return shader};this.init()}function Config(_anim){this._count=0;this._oldTIme=0;this._d=1;this._oldTime=Date.now();_anim.addEnterFrame(this,"enterFrame");this.enterFrame=function(){var time=Date.now();var diff=(time-this._oldTime)/1e3;var newTime=diff/.016;if(newTime>=3){newTime=3}this._nd=newTime;this._d=.8*this._d+.2*newTime;this.s1=1*this._d;this.s005=.05*this._d;this.s03=.3*this._d;this.s14=1.4*this._d;this.s0020=.02*this._d;this.s0016=.016*this._d;this.s099a=1-.01*this._d;this.s099b=1-this.s099a;this.s098a=1-.02*this._d;this.s098b=1-this.s098a;this.s097a=1-.03*this._d;this.s097b=1-this.s097a;this.s096a=1-.04*this._d;this.s096b=1-this.s096a;this.s095a=1-.05*this._d;this.s095b=1-this.s095a;this.s094a=1-.06*this._d;this.s094b=1-this.s094a;this.s093a=1-.07*this._d;this.s093b=1-this.s093a;this.s092a=1-.08*this._d;this.s092b=1-this.s092a;this.s091a=1-.09*this._d;this.s091b=1-this.s091a;this.s090a=1-.1*this._d;this.s090b=1-this.s090a;this.s089a=1-.11*this._d;this.s089b=1-this.s089a;this.s088a=1-.12*this._d;this.s088b=1-this.s088a;this.s087a=1-.13*this._d;this.s087b=1-this.s087a;this.s086a=1-.14*this._d;this.s086b=1-this.s086a;this.s085a=1-.15*this._d;this.s085b=1-this.s085a;this.s084a=1-.16*this._d;this.s084b=1-this.s084a;this.s083a=1-.17*this._d;this.s083b=1-this.s083a;this.s082a=1-.18*this._d;this.s082b=1-this.s082a;this.s081a=1-.19*this._d;this.s081b=1-this.s081a;this.s080a=1-.2*this._d;this.s080b=1-this.s080a;this.s070a=1-.2*this._d;this.s070b=1-this.s070a;this.s060a=1-.4*this._d;this.s060b=1-this.s060a;this._oldTime=time}}function Liquid(_anim){this._trg=null;this._funcName="";this.set=function(a,b){null!==this._trg&&void 0!==this._trg||(this._trg=a,this._funcName=b,_anim.addEnterFrame(this,"onEnterFrame"))};this.onEnterFrame=function(){this._trg[this._funcName]()};this.clear=function(){null!==this._trg&&void 0!==this._trg&&(_anim.removeEnterFrame(this),this._trg=null,this._funcName="")}}function StaticLiquid(_anim,scene,textureID,width,height,scale,x,y,z,rotation,move){this._parent=scene;this._textureID=textureID;this._width=width;this._height=height;this._scale=scale;this._x=x;this._y=y;this._z=z;this._rotation=rotation;this.init=function(){this._bc=new Liquid(_anim);this._baseY=-50;this._startY=-50;this._geo=new THREE.PlaneBufferGeometry(this._width*this._scale,this._height*this._scale,2,2);this._mat1=new THREE.MeshBasicMaterial({map:_anim._assets.getTex(this._textureID),transparent:true});this._mat2=new THREE.MeshBasicMaterial({map:_anim._assets.getTex(this._textureID+"_n"),transparent:true});this._mat1.opacity=1;this._mat2.opacity=0;this._mesh=new THREE.SceneUtils.createMultiMaterialObject(this._geo,[this._mat1,this._mat2]);this._mesh.position.x=2500;this._mesh.rotation.z=this._rotation;this._parent._scene.add(this._mesh);_anim.addEnterFrame(this,"enterFrame")};this.enterFrame=function(){var a=window.innerHeight+this._startY;this._baseY=.98*this._baseY+_anim._view._scrollPos*a*.02;this._mesh.position.y=this._baseY;this._mesh.position.x=.99*this._mesh.position.x+0};this.init()}function CenterLiquid(_anim,scene,textureID,width,height,scale,offset){this._parent=scene;this._textureID=textureID;this._width=width;this._height=height;this._scale=scale;this._offset=offset;this.init=function(){this._bc=new Liquid(_anim);this._baseY=-150;this._startY=-150;this._geo=new THREE.PlaneBufferGeometry(this._width*this._scale,this._height*this._scale,2,2);this._mat1=new THREE.MeshBasicMaterial({map:_anim._assets.getTex(this._textureID),transparent:true}),this._mat2=new THREE.MeshBasicMaterial({map:_anim._assets.getTex(this._textureID+"_n"),transparent:true});this._mat1.opacity=1;this._mat2.opacity=0;this._mesh=new THREE.SceneUtils.createMultiMaterialObject(this._geo,[this._mat1,this._mat2]);this._mesh.position.x=-(.5*_anim._wrapper.offsetWidth+this._offset*this._scale);this._mesh.position.z=-100;this._mesh.position.y=this._baseY;this._mesh.scale.x=.8;this._parent._scene.add(this._mesh);this._sin=0;_anim.addEnterFrame(this,"enterFrame")};this.enterFrame=function(){var start=window.innerHeight*_anim._view._scrollPos;this._baseY=.98*this._baseY+.02*start,this._mesh.position.y=this._baseY+this._startY,this._mesh.position.x+=2;this._sin=(this._sin+1)%360;this._mesh.rotation.z=.2*Math.sin(this._sin*Math.PI/180);if(this._mesh.position.x>.5*_anim._wrapper.offsetWidth+this._offset*this._scale){this._mesh.position.x=-(.5*_anim._wrapper.offsetWidth+this._offset*this._scale)}};this.init()}function CloneLiquid(_anim,scene,textureID,width,height,scale,offset){this._parent=scene;this._textureID=textureID;this._width=width;this._height=height;this._scale=scale;this._offset=offset;this.init=function(){this._bc=new Liquid(_anim);this._baseY=400;this._startY=this._baseY;this._geo=new THREE.PlaneBufferGeometry(this._width*this._scale,this._height*this._scale,2,2);this._mat1=new THREE.MeshBasicMaterial({map:_anim._assets.getTex(this._textureID),transparent:true}),this._mat2=new THREE.MeshBasicMaterial({map:_anim._assets.getTex(this._textureID+"_n"),transparent:true});this._mat1.opacity=1;this._mat2.opacity=0;this._mesh=new THREE.SceneUtils.createMultiMaterialObject(this._geo,[this._mat1,this._mat2]);this._mesh.position.x=-(.5*_anim._wrapper.offsetWidth+this._offset*this._scale);this._mesh.position.z=-20;this._mesh.position.y=this._baseY;this._mesh.scale.x=.7;this._parent._scene.add(this._mesh);this._sin=0;_anim.addEnterFrame(this,"enterFrame")};this.enterFrame=function(){var a=window.innerHeight*_anim._view._scrollPos;this._baseY=.98*this._baseY+.02*a;this._mesh.position.y=this._baseY+this._startY;this._sin=(this._sin+1)%360;var b=.6*Math.sin(this._sin*Math.PI/180);this._mesh.position.x+=1.2;this._mesh.rotation.z=b;if(this._mesh.position.x>.5*_anim._wrapper.offsetWidth+this._offset*this._scale){this._mesh.position.x=-(.5*_anim._wrapper.offsetWidth+this._offset*this._scale)}};this.init()}function MovingLiquid(_anim,scene,textureID,width,height,scale,type,offset){this._parent=scene;this._textureID=textureID;this._width=width;this._height=height;this._scale=scale;this._type=type;this._offset=offset;this.init=function(){this._bc=new Liquid(_anim);this._geo=new THREE.PlaneBufferGeometry(this._width*this._scale,this._height*this._scale,2,2);this._mat1=new THREE.MeshBasicMaterial({map:_anim._assets.getTex(this._textureID),transparent:true});this._mat2=new THREE.MeshBasicMaterial({map:_anim._assets.getTex(this._textureID+"_n"),transparent:true});this._mat1.opacity=1;this._mat2.opacity=0;this._mesh=new THREE.SceneUtils.createMultiMaterialObject(this._geo,[this._mat1,this._mat2]);if(this._type==="type1"){this._baseY=200;this._startY=200;this._mesh.position.x=-(.5*_anim._wrapper.offsetWidth+this._offset*this._scale);this._mesh.position.z=-50;this._mesh.position.y=this._baseY;this._mesh.scale.x=.8}else if(this._type==="type2"){this._baseY=-200;this._startY=-200;this._mesh.position.x=.5*_anim._wrapper.offsetWidth+this._offset*this._scale;this._mesh.position.z=-20;this._mesh.position.y=this._baseY;this._mesh.scale.set(.55,.55,.55)}else if(this._type==="type3"){this._baseY=200;this._startY=200;this._mesh.position.x=.5*_anim._wrapper.offsetWidth+this._offset*this._scale;this._mesh.position.z=-200;this._mesh.position.y=this._baseY}this._parent._scene.add(this._mesh);this._sin=0;_anim.addEnterFrame(this,"enterFrame")};this.enterFrame=function(){if(this._type==="type1"){var a=window.innerHeight*_anim._view._scrollPos;this._baseY=.98*this._baseY+.02*a;this._mesh.position.y=this._baseY+this._startY;this._mesh.position.x+=1.2;this._sin=(this._sin+1)%360;var b=.2*Math.sin(this._sin*Math.PI/180);this._mesh.rotation.z=b;if(_anim._device==="PC"){if(this._mesh.position.x>.5*_anim._wrapper.offsetWidth+this._offset*this._scale){this._mesh.position.x=-(.5*_anim._wrapper.offsetWidth+this._offset*this._scale)}}}else if(this._type==="type2"){var a=_anim._wrapper.offsetHeight*_anim._view._scrollPos;this._baseY=.98*this._baseY+.02*a;this._mesh.position.y=this._baseY+this._startY;this._mesh.position.x-=1.2;if(this._mesh.position.x<-(.5*_anim._wrapper.offsetWidth+this._offset*this._scale)){this._mesh.position.x=.5*_anim._wrapper.offsetWidth+this._offset*this._scale}}else if(this._type==="type3"){var a=_anim._wrapper.offsetHeight*_anim._view._scrollPos;this._baseY=.98*this._baseY+.02*a;this._mesh.position.y=this._baseY+this._startY;this._mesh.position.x-=1.2;if(this._mesh.position.x<-(.5*_anim._wrapper.offsetWidth+this._offset*this._scale)){this._mesh.position.x=.5*_anim._wrapper.offsetWidth+this._offset*this._scale}}};this.init()}function DistordShader(_anim){this._baseW=1600;this._baseH=800;this._time=0;this._speed=1;this._strength=.05;this._size=8;this._sin=0;this.init=function(){this._width=_anim._view._renderW;this._height=_anim._view._renderH;this._geo=new THREE.PlaneBufferGeometry(this._baseW,this._baseH,2,2);this._shader={vertexShader:_anim._assets.getShader("./assets/shaders/display_vtx.js"),fragmentShader:_anim._assets.getShader("./assets/shaders/display_frg.js"),uniforms:{texture:{value:_anim._view._liquidScene._render.texture},time:{value:this._time},speed:{value:this._speed},strength:{value:this._strength},size:{value:this._size},isNight:{value:this.isNight}},transparent:true};this._mat=new THREE.ShaderMaterial(this._shader);this._mesh=new THREE.Mesh(this._geo,this._mat);this._mesh.position.z=0;_anim._view._scene.add(this._mesh);_anim.addResize(this);this.onResize();_anim._view.setupCompRender(this);_anim.addEnterFrame(this,"enterFrame")};this.enterFrame=function(){this._time+=.012;this._shader.uniforms.time.value=this._time;this._sin+=.1;this._sin>=180&&(this._sin=0);var a=Math.sin(this._sin*Math.PI/180);this._shader.uniforms.strength.value=.025*a+.03};this.onResize=function(){var a=_anim._wrapper.offsetWidth/this._baseW,b=_anim._wrapper.offsetHeight/this._baseH;a>=b?this._mesh.scale.set(1.2*a,1.1*a,a):this._mesh.scale.set(1.2*b,1.1*b,b)};this.init()}function LiquidAnimation(params){var self=this;this._assets=null;this._resizeList=[];this._compFunc=params.complete;this._device=window.innerWidth<768?"SP":"PC";this._wrapperId=params.wrapperId;this._wrapper=document.getElementById(params.wrapperId);this._assetsPath=params.assetsPath;this._webGL=true;this._colorType=0;this.isWorldReady=false;this.isScroll=true;this._view=null;this._enterFrameList=[];this.init=function(){this.$window=$(window);this.windowHeight;$(window).on("resize",function(){self.onGLResize()});this.setUAComp()};this.setUAComp=function(){this._conf=new Config(self);this.playClick()};this.playClick=function(){this._assets=new AssetsManager(self);this._assets.firstLoad();this.animationStart()};this.partsLoadComp=function(){this.createWorld()};this.createWorld=function(){this._sceneMng=new SceneManager(self);this._view=new View(self);this._view.init()};this.mediaCheck=function(){this.contentsStart()};this.contentsStart=function(){self._view.contetnsStart();setTimeout(function(){self._compFunc()},1e3)};this.addEnterFrame=function(a,b){var c={_target:a,_function:b};this._enterFrameList.push(c)};this.removeEnterFrame=function(a){this.isFrameLock=true;for(var b=this._enterFrameList.length,c=-1,d=0;d<b;d++)if(this._enterFrameList[d]._target===a){c=d;break}if(-1===c)return void(this.isFrameLock=false);this._enterFrameList.splice(c,1),this.isFrameLock=false};this.animationStart=function(){void 0!==window.requestAnimationFrame?self.animationType1():self.animationType2()};this.animationType1=function(){this.animationLoop(),this._anim=requestAnimationFrame(function(){self.animationType1()})};this.animationType2=function(){this.animationLoop(),this._anim=setTimeout(function(){self.animationType2b()},20)};this.animationType2b=function(){self.animationType2()};this.animationLoop=function(){if(!this.isFrameLock)for(var a=this._enterFrameList.length,b=0;b<a;b++)if(void 0!==this._enterFrameList[b]){var c=this._enterFrameList[b]._target,d=this._enterFrameList[b]._function;c[d]()}};this.addResize=function(a){this._resizeList.push(a)};this.removeResize=function(a){var b,c=[];for(b=0;b<this._resizeList.length;b++)this._resizeList[b]!==a&&c.push(this._resizeList[b]);for(this._resizeList=[],b=0;b<c.length;b++)this._resizeList.push(c[b])};this.onGLResize=function(){this.windowHeight=window.innerHeight;for(var a=0;a<this._resizeList.length;a++)this._resizeList[a].onResize()}}function LiquidScene(_anim){this.isNight=false;this._width=0;this._height=0;this._render=null;this._scene=null;this._cam=null;this._fov=90;this._far=5e3;this._near=.1;this.isChange=true;this.init=function(){this._width=_anim._view._renderW;this._height=_anim._view._renderH;this._cam=new THREE.PerspectiveCamera(this._fov,this._width/this._height,this._near,this._far);this._cam.position.x=0;this._cam.position.y=0;this._cam.position.z=450;this._scene=new THREE.Scene;this._render=new THREE.WebGLRenderTarget(_anim._view._renderW,_anim._view._renderH,{magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter,wrapS:THREE.ClampToEdgeWrapping,wrapT:THREE.ClampToEdgeWrapping});this._bgPlane=new Plane(_anim,this);if(_anim._device==="PC"){this._liquid1=new StaticLiquid(_anim,this,"black",2189,526,.95,0,0,100,-.1);this._liquid2=new CloneLiquid(_anim,this,"red_1",626,467,1,500);this._liquid3=new MovingLiquid(_anim,this,"yellow_2",848,376,1,"type2",800);this._liquid4=new MovingLiquid(_anim,this,"yellow_1",1164,480,1,"type1",1500);this._liquid5=new CenterLiquid(_anim,this,"red_2",767,411,1,2300);this._liquid6=new MovingLiquid(_anim,this,"yellow_2",848,376,1,"type3",2500)}else{this._liquid1=new StaticLiquid(_anim,this,"black",2189,526,.7,0,0,100,-.1);this._liquid2=new CloneLiquid(_anim,this,"red_1",626,467,.7,1e3);this._liquid3=new MovingLiquid(_anim,this,"yellow_2",848,376,.7,"type2",1100);this._liquid4=new MovingLiquid(_anim,this,"yellow_1",1164,480,.7,"type1",1500);this._liquid5=new CenterLiquid(_anim,this,"red_2",767,411,.7,2e3);this._liquid6=new MovingLiquid(_anim,this,"yellow_2",848,376,.7,"type3",2300)}_anim.addEnterFrame(this,"enterFrame")};this.enterFrame=function(){_anim._view._render.render(this._scene,this._cam,this._render)};this.onResize=function(){this._width=_anim._view._renderW;this._height=_anim._view._renderW;this._render.setSize(_anim._view._renderW,_anim._view._renderH);this._cam.aspect=this._width/this._height;this._cam.updateProjectionMatrix()};this.init()}function Plane(_anim,scene){this._parent=scene;this._width=1600;this._height=800;this._trgAlpha=0;this.init=function(){this._geo=new THREE.PlaneBufferGeometry(this._width,this._height,1,1);this._mat=new THREE.MeshBasicMaterial({color:0,transparent:true,opacity:0});this._mesh=new THREE.Mesh(this._geo,this._mat);this._mesh.position.z=-100;this._parent._scene.add(this._mesh);_anim.addResize(this);this.onResize()};this.enterFrame=function(){this._mat.opacity=.97*this._mat.opacity+.03*this._trgAlpha;if(Math.abs(this._mat.opacity-this._trgAlpha)<.01){this._mat.opacity=this._trgAlpha;_anim.removeEnterFrame(this)}};this.onResize=function(){var ratioA=_anim._wrapper.offsetWidth/this._width;var ratioB=_anim._wrapper.offsetHeight/this._height;if(ratioA>=ratioB){this._mesh.scale.set(2*ratioA,3*ratioA,2*ratioA)}else{this._mesh.scale.set(2*ratioB,3*ratioB,2*ratioB)}};this.init()}function SceneManager(_anim){this._status=-1;this.contentsStart=function(){_anim.addEnterFrame(this,"enterFrame")};this.enterFrame=function(){var a=_anim._sound.getPosition();if(this._status===-1){if(a>=1){this._status=0}}}}function View(_anim){this._id=_anim._wrapperId;this._width=0;this._height=0;this._render=null;this._renderW=2500;this._renderH=700;this._scene=null;this._root=null;this._display=null;this._cam=null;this._fov=45;this._far=3e3;this._near=.1;this._liquidScene=null;this.init=function(){this._allScroll=0;this._width=_anim._wrapper.offsetWidth;this._height=_anim._wrapper.offsetHeight;this.setViewPort();this._cam=new THREE.OrthographicCamera(this._viewPort.left,this._viewPort.right,this._viewPort.top,this._viewPort.bottom,this._viewPort.near,this._viewPort.far);this._cam.position.set(0,0,10);this._scene=new THREE.Scene;this._render=new THREE.WebGLRenderer({antialias:false,alpha:true});this._render.setPixelRatio(1);this._render.setSize(this._width,this._height);document.getElementById(this._id).appendChild(this._render.domElement);_anim.addResize(this);this.onResize();this._liquidScene=new LiquidScene(_anim);this._distordShader=new DistordShader(_anim)};this.setupCompRender=function(){this.playAnimation()};this.playAnimation=function(){this.onEnterFrame();_anim.addEnterFrame(this,"onEnterFrame");_anim.mediaCheck("world")};this.contetnsStart=function(){};this.onEnterFrame=function(){this._allScroll=$(window).scrollTop();this._allHeight=$(document.body).height();this._allHeight&&(this._scrollPos=this._allScroll/this._allHeight);this._render.render(this._scene,this._cam)};this.setViewPort=function(){this._viewPort={};var a=this._width,b=this._height,c=b,d=a/b;this._viewPort={viewSize:c,aspectRatio:d,left:-d*c/2,right:d*c/2,top:c/2,bottom:-c/2,near:0,far:1e4}};this.onResize=function(){this._renderW=Math.floor(this._renderW);this._renderH=Math.floor(this._renderH);this._width=_anim._wrapper.offsetWidth;this._height=_anim._wrapper.offsetHeight;this.setViewPort();this._cam.left=this._viewPort.left;this._cam.right=this._viewPort.right;this._cam.top=this._viewPort.top;this._cam.bottom=this._viewPort.bottom;this._cam.updateProjectionMatrix();this._render.setSize(this._width,this._height)}}$(function(){var animation=new LiquidAnimation({wrapperId:"animation",assetsPath:ASSETS_PATH,complete:function(){console.log("Animation loaded")}});animation.init()});